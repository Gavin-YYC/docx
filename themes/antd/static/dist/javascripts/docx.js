!function(t){function e(e,a,r){var o=this;return this.on("click.pjax",e,function(e){var i=t.extend({},m(a,r));i.container||(i.container=t(this).attr("data-pjax")||o),n(e,i)})}function n(e,n,a){var o,i,c,s;if(a=m(n,a),"A"!==(o=e.currentTarget).tagName.toUpperCase())throw"$.fn.pjax or $.pjax.click requires an anchor element";e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||location.protocol===o.protocol&&location.hostname===o.hostname&&(o.href.indexOf("#")>-1&&h(o)==h(location)||e.isDefaultPrevented()||(i={url:o.href,container:t(o).attr("data-pjax"),target:o},c=t.extend({},i,a),s=t.Event("pjax:click"),t(o).trigger(s,[c]),s.isDefaultPrevented()||(r(c),e.preventDefault(),t(o).trigger("pjax:clicked",[c]))))}function a(e,n,a){var o,i,c;if(a=m(n,a),o=e.currentTarget,i=t(o),"FORM"!==o.tagName.toUpperCase())throw"$.pjax.submit requires a form element";if("GET"!==(c={type:(i.attr("method")||"GET").toUpperCase(),url:i.attr("action"),container:i.attr("data-pjax"),target:o}).type&&void 0!==window.FormData)c.data=new FormData(o),c.processData=!1,c.contentType=!1;else{if(t(o).find(":file").length)return;c.data=t(o).serializeArray()}r(t.extend({},c,a)),e.preventDefault()}function r(e){function n(e,n,r){r||(r={}),r.relatedTarget=a;var o=t.Event(e,r);return c.trigger(o,n),!o.isDefaultPrevented()}var a,o,c,s,h;return e=t.extend(!0,{},t.ajaxSettings,r.defaults,e),t.isFunction(e.url)&&(e.url=e.url()),a=e.target,o=f(e.url).hash,c=e.context=x(e.container),e.data||(e.data={}),t.isArray(e.data)?e.data.push({name:"_pjax",value:c.selector}):e.data._pjax=c.selector,e.beforeSend=function(t,a){if("GET"!==a.type&&(a.timeout=0),t.setRequestHeader("X-PJAX","true"),t.setRequestHeader("X-PJAX-Container",c.selector),!n("pjax:beforeSend",[t,a]))return!1;a.timeout>0&&(s=setTimeout(function(){n("pjax:timeout",[t,e])&&t.abort("timeout")},a.timeout),a.timeout=0);var r=f(a.url);o&&(r.hash=o),e.requestUrl=d(r)},e.complete=function(t,a){s&&clearTimeout(s),n("pjax:complete",[t,a,e]),n("pjax:end",[t,e])},e.error=function(t,a,r){var o=v("",t,e),c=n("pjax:error",[t,a,r,e]);"GET"==e.type&&"abort"!==a&&c&&i(o.url)},e.success=function(a,s,u){var p,d,h,m,x=r.state,g="function"==typeof t.pjax.defaults.version?t.pjax.defaults.version():t.pjax.defaults.version,j=u.getResponseHeader("X-PJAX-Version"),w=v(a,u,e),b=f(w.url);if(o&&(b.hash=o,w.url=b.href),g&&j&&g!==j)i(w.url);else if(w.contents){if(r.state={id:e.id||l(),url:w.url,title:w.title,container:c.selector,fragment:e.fragment,timeout:e.timeout},(e.push||e.replace)&&window.history.replaceState(r.state,w.title,w.url),t.contains(e.container,document.activeElement))try{document.activeElement.blur()}catch(t){}w.title&&(document.title=w.title),n("pjax:beforeReplace",[w.contents,e],{state:r.state,previousState:x}),c.html(w.contents),(p=c.find("input[autofocus], textarea[autofocus]").last()[0])&&document.activeElement!==p&&p.focus(),y(w.scripts),d=e.scrollTo,o&&(h=decodeURIComponent(o.slice(1)),(m=document.getElementById(h)||document.getElementsByName(h)[0])&&(d=t(m).offset().top)),"number"==typeof d&&t(window).scrollTop(d),n("pjax:success",[a,s,u,e])}else i(w.url)},r.state||(r.state={id:l(),url:window.location.href,title:document.title,container:c.selector,fragment:e.fragment,timeout:e.timeout},window.history.replaceState(r.state,document.title)),u(r.xhr),r.options=e,(h=r.xhr=t.ajax(e)).readyState>0&&(e.push&&!e.replace&&(w(r.state.id,p(c)),window.history.pushState(null,"",e.requestUrl)),n("pjax:start",[h,e]),n("pjax:send",[h,e])),r.xhr}function o(e,n){var a={url:window.location.href,push:!1,replace:!0,scrollTo:!1};return r(t.extend(a,m(e,n)))}function i(t){window.history.replaceState(null,"",r.state.url),window.location.replace(t)}function c(e){var n,a,o,c,s,l,d,f,h;if(R||u(r.xhr),n=r.state,(a=e.state)&&a.container){if(R&&U==a.url)return;if(n){if(n.id===a.id)return;o=n.id<a.id?"forward":"back"}c=C[a.id]||[],s=t(c[0]||a.container),l=c[1],s.length?(n&&b(o,n.id,p(s)),d=t.Event("pjax:popstate",{state:a,direction:o}),s.trigger(d),f={id:a.id,url:a.url,container:s,push:!1,fragment:a.fragment,timeout:a.timeout,scrollTo:!1},l?(s.trigger("pjax:start",[null,f]),r.state=a,a.title&&(document.title=a.title),h=t.Event("pjax:beforeReplace",{state:a,previousState:n}),s.trigger(h,[l,f]),s.html(l),s.trigger("pjax:end",[null,f])):r(f),s[0].offsetHeight):i(location.href)}R=!1}function s(e){var n,a,r=t.isFunction(e.url)?e.url():e.url,o=e.type?e.type.toUpperCase():"GET",i=t("<form>",{method:"GET"===o?"GET":"POST",action:r,style:"display:none"});if("GET"!==o&&"POST"!==o&&i.append(t("<input>",{type:"hidden",name:"_method",value:o.toLowerCase()})),"string"==typeof(n=e.data))t.each(n.split("&"),function(e,n){var a=n.split("=");i.append(t("<input>",{type:"hidden",name:a[0],value:a[1]}))});else if(t.isArray(n))t.each(n,function(e,n){i.append(t("<input>",{type:"hidden",name:n.name,value:n.value}))});else if("object"==typeof n)for(a in n)i.append(t("<input>",{type:"hidden",name:a,value:n[a]}));t(document.body).append(i),i.submit()}function u(e){e&&e.readyState<4&&(e.onreadystatechange=t.noop,e.abort())}function l(){return(new Date).getTime()}function p(t){var e=t.clone();return e.find("script").each(function(){this.src||jQuery._data(this,"globalEval",!1)}),[t.selector,e.contents()]}function d(t){return t.search=t.search.replace(/([?&])(_pjax|_)=[^&]*/g,""),t.href.replace(/\?($|#)/,"$1")}function f(t){var e=document.createElement("a");return e.href=t,e}function h(t){return t.href.replace(/#.*/,"")}function m(e,n){return e&&n?n.container=e:n=t.isPlainObject(e)?e:{container:e},n.container&&(n.container=x(n.container)),n}function x(e){if((e=t(e)).length){if(""!==e.selector&&e.context===document)return e;if(e.attr("id"))return t("#"+e.attr("id"));throw"cant get selector for pjax container!"}throw"no pjax container for "+e.selector}function g(t,e){return t.filter(e).add(t.find(e))}function j(e){return t.parseHTML(e,document,!0)}function v(e,n,a){var r,o,i,c={},s=/<html/i.test(e),u=n.getResponseHeader("X-PJAX-URL");return c.url=u?d(f(u)):a.requestUrl,s?(r=t(j(e.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0])),o=t(j(e.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]))):r=o=t(j(e)),0===o.length?c:(c.title=g(r,"title").last().text(),a.fragment?(i="body"===a.fragment?o:g(o,a.fragment).first()).length&&(c.contents="body"===a.fragment?i:i.contents(),c.title||(c.title=i.attr("title")||i.data("title"))):s||(c.contents=o),c.contents&&(c.contents=c.contents.not(function(){return t(this).is("title")}),c.contents.find("title").remove(),c.scripts=g(c.contents,"script[src]").remove(),c.contents=c.contents.not(c.scripts)),c.title&&(c.title=t.trim(c.title)),c)}function y(e){if(e){var n=t("script[src]");e.each(function(){var e,a,r=this.src;n.filter(function(){return this.src===r}).length||(e=document.createElement("script"),(a=t(this).attr("type"))&&(e.type=a),e.src=t(this).attr("src"),document.head.appendChild(e))})}}function w(t,e){C[t]=e,D.push(t),T(A,0),T(D,r.defaults.maxCacheLength)}function b(t,e,n){var a,o;C[e]=n,"forward"===t?(a=D,o=A):(a=A,o=D),a.push(e),(e=o.pop())&&delete C[e],T(a,r.defaults.maxCacheLength)}function T(t,e){for(;t.length>e;)delete C[t.shift()]}function E(){return t("meta").filter(function(){var e=t(this).attr("http-equiv");return e&&"X-PJAX-VERSION"===e.toUpperCase()}).attr("content")}function S(){t.fn.pjax=e,t.pjax=r,t.pjax.enable=t.noop,t.pjax.disable=P,t.pjax.click=n,t.pjax.submit=a,t.pjax.reload=o,t.pjax.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:E},t(window).on("popstate.pjax",c)}function P(){t.fn.pjax=function(){return this},t.pjax=s,t.pjax.enable=S,t.pjax.disable=t.noop,t.pjax.click=t.noop,t.pjax.submit=t.noop,t.pjax.reload=function(){window.location.reload()},t(window).off("popstate.pjax",c)}var C,A,D,R=!0,U=window.location.href,X=window.history.state;X&&X.container&&(r.state=X),"state"in window.history&&(R=!1),C={},A=[],D=[],t.inArray("state",t.event.props)<0&&t.event.props.push("state"),t.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/),t.support.pjax?S():P()}(jQuery);
$.fn.fullImage=function(e){e=e||{};var a=$(document.body),t=(e.el,$(document.head)),o=$(this);t.append("<style>.c-fullimage-close{cursor:pointer;}.c-fullimage-c{position:absolute;right:30px;top:20px;width:4px;height:20px;background-color:#fff;-moz-transform:rotate(45deg);-o-transform:rotate(45deg);-webkit-transform:rotate(45deg);transform:rotate(45deg);}.c-fullimage-cs{-moz-transform:rotate(135deg);-o-transform:rotate(135deg);-webkit-transform:rotate(135deg);transform:rotate(135deg);}.c-fullimage{position:fixed;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.85);z-index:9999;display:none;padding:50px 0;}.c-fullimage-wr{background-size:contain;background-repeat:no-repeat;background-position:center;width:100%;height:100%;}</style>"),a.append('<div class="c-fullimage"><div class="c-fullimage-close"><div class="c-fullimage-c"></div><div class="c-fullimage-c c-fullimage-cs"></div></div><div class="c-fullimage-wr"></div></div>');var i=$(".c-fullimage"),r=$(".c-fullimage-wr"),c=$(".c-fullimage-close");o.on("click","img",function(e){var a=$(this).attr("src");r.css("background-image","url("+a+")"),i.show()}),c.on("click",function(){i.hide()})};
function itemTip(){$docxList.empty().hide();var a="";$docxBd.find("h2,h3,h4").each(function(s,e){var t=$(e).get(0).localName,c=$(this).text();a+='<a class="docx-'+t+'" href="#'+encodeURIComponent(c)+'">'+c+"</a></br>"}),a||(a+='<a href="#">暂无标题</a>'),$docxList.append(a)}function changeMenu(){$(".active,.subactive").removeClass("active subactive"),$(".docx-navs .in").removeClass("in");var a=location.pathname||"",s=$('[data-path="'+a+'"]');s.parents(".docx-submenu").addClass("in").css("height","auto"),s.parents("[data-dir]").addClass("active subactive"),$docxTitle.removeClass("docx-active"),s.addClass("docx-active").parents().remove("docx-active");var e=$(".docx-active"),t=e.length&&e.offset().top;(t>winH-lisH||t<0)&&$scollapse.animate({scrollTop:t-winH/5},200)}var $win=$(window),$navs=$(".docx-navs"),$navbarH=$(".navbar").height(),$docxTitle=$(".docx-files"),$docxBd=$(".docx-body"),$docxDir=$(".docx-dir>a"),$searchIpt=$(".docx-searchkey"),$sug=$(".docx-sug"),$sugH=200,$liHeight=39,$sugul=$(".docx-sugul"),actCls="docx-sugact",winH=$win.outerHeight(),lisH=$docxTitle.first().height(),$scollapse=$("#sidebar-collapse"),$fixedstyle=$(".docx-fixedstyle"),$docxList=$(".docx-list");$.support.pjax&&($(document).pjax('a[href^="/"]',".docx-marked-wrap",{timeout:1200}),$(document).on("pjax:complete",function(){changeMenu(),$sug.hide(),itemTip()})),$(function(){$win.on("resize",function(){$docxBd.height($win.height()-$navbarH),winH=$win.outerHeight()}),$docxBd.height($win.height()-$navbarH),itemTip(),$(".docx-tips").on("click",function(){$docxList.toggle()}),$fixedstyle.remove(),$(".docx-marked-wrap").fullImage()}),$win.load(changeMenu),$searchIpt.on("input focus",function(a){var s=$searchIpt.val();s.trim()?($sug.show(),$.ajax({url:"/api/search",data:{name:s,type:"title"},type:"post"}).done(function(a){var e=a.data,t="";Array.isArray(e)&&e.length&&e.forEach(function(a,s){var e="";0===s&&(e="docx-sugact"),t+='<li><a href="'+a.path+'" class="'+e+'">'+a.title+"</a></li>"}),t+='<li class="docx-fullse"><a href="#">全文搜索<span class="hljs-string">'+s+"</span></a></li>",$sugul.html(t)})):$sug.hide()}),$docxBd.on("click",".docx-fullse",function(){var a=$searchIpt.val();$.ajax({url:"/api/search",data:{name:a},type:"post"}).done(function(a){var s=a.data,e="";Array.isArray(s)&&s.length&&(s.forEach(function(a){var s=a.content||"";s=s.replace(/<(table).*?<\/\1>|<table.*?>|<\/table>/g,""),e+=['<div class="docx-search-art">','    <div class="docx-search-title">','        <a href="'+a.path+'" class="doc-search-link">',a.title,"        </a>","    </div>",'    <div class="docx-search-content">','        <a href="'+a.path+'" class="doc-search-link">',s,"        </a>","    </div>","</div>"].join("")}),$sug.hide()),$(".docx-marked").html(e||'<div class="docx-search-nocontent">暂无匹配文档!</div>')})}),$navs.metisMenu({preventDefault:!1}),$docxTitle.add($docxDir).on("click",function(){$(".docx-active").removeClass("docx-active"),$(this).addClass("docx-active")}),$searchIpt.on("keydown",function(a){var s=a.keyCode,e=$(".docx-sugul>li"),t=$(".docx-sugact");38===s?(0===t.length?e.last().addClass(actCls):t.is(":first-child")?(t.removeClass(),e.last().addClass(actCls),$sug.scrollTop($sugul.height()-$sugH)):t.removeClass().prev().addClass(actCls),t.offset()&&t.offset().top>$sugH&&$sug.scrollTop($sug.scrollTop()-39)):40===s?(0===t.length?e.first().addClass(actCls):t.is(":last-child")?(t.removeClass(),$sug.scrollTop(0),e.first().addClass(actCls)):t.removeClass().next().addClass(actCls),t.offset()&&t.offset().top>$sugH&&$sug.scrollTop($sug.scrollTop()+$liHeight)):13===s&&(1===e.length&&(e.click(),$sug.hide()),t.find("a").click())});